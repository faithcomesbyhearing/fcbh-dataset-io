TO BUILD
cd project root and go build -o dataset controller/dataset_cli/dataset.go

TO RUN
source setup_env.sh
./dataset bible_brain/timestamp/update/engnivn1da_hls_test.yaml
(or whatever yaml)

TO REMOVE A TEST FILESET
mysql -u root -p dbp_localtest -e "SET @hash_id = (SELECT hash_id FROM bible_filesets WHERE id = 'ENGNIVN1SA'); DELETE FROM bible_file_stream_bytes WHERE stream_bandwidth_id IN (SELECT id FROM bible_file_stream_bandwidths WHERE bible_file_id IN (SELECT id FROM bible_files WHERE hash_id = @hash_id)); DELETE FROM bible_file_stream_bandwidths WHERE bible_file_id IN (SELECT id FROM bible_files WHERE hash_id = @hash_id); DELETE FROM bible_files WHERE hash_id = @hash_id; DELETE FROM bible_fileset_connections WHERE hash_id = @hash_id; DELETE FROM bible_fileset_tags WHERE hash_id = @hash_id; DELETE FROM bible_filesets WHERE hash_id = @hash_id; SELECT 'Removed ENGNIVN1SA fileset and all HLS data' AS result;"

TO TRACE AN AUDIO HLS FILESETS LINK
# the SA
mysql -u root dbp_localtest -e "SELECT bf_sa.id as fileset_id, bf_sa.hash_id, bf_file.file_name, bw.file_name as bandwidth_name, bytes.runtime, bytes.timestamp_id, NULL as verse_start, NULL as timestamp FROM bible_filesets bf_sa JOIN bible_files bf_file ON bf_sa.hash_id = bf_file.hash_id JOIN bible_file_stream_bandwidths bw ON bf_file.id = bw.bible_file_id JOIN bible_file_stream_bytes bytes ON bw.id = bytes.stream_bandwidth_id WHERE bf_sa.id = 'ENGNIVN1SA' LIMIT 1;"
# the corresponding DA
mysql -u root dbp_localtest -e "SELECT bf_da.id as fileset_id, bf_da.hash_id, ts_file.file_name, NULL as bandwidth_name, NULL as runtime, ts.id as timestamp_id, ts.verse_start, ts.timestamp FROM bible_file_stream_bytes bytes JOIN bible_file_timestamps ts ON bytes.timestamp_id = ts.id JOIN bible_files ts_file ON ts.bible_file_id = ts_file.id JOIN bible_filesets bf_da ON ts_file.hash_id = bf_da.hash_id WHERE bytes.stream_bandwidth_id IN (SELECT bw.id FROM bible_filesets bf_sa JOIN bible_files bf_file ON bf_sa.hash_id = bf_file.hash_id JOIN bible_file_stream_bandwidths bw ON bf_file.id = bw.bible_file_id WHERE bf_sa.id = 'ENGNIVN1SA') LIMIT 1;"
