{"id":"arti-1j9","content_hash":"062dff7e2444831f3cf0c8933a55136f998b076d873c0ca86b2b81999c7bef55","title":"Add revise_audio YAML configuration parsing to decode_yaml/request","description":"Extend YAML config structure:\n- Add ReviseAudio struct to decode_yaml/request/model.go\n- Support subcategories (boolean flags) for selected tools:\n  * revise_audio:rvc:yes (voice conversion)\n  * revise_audio:prosody_dsp:yes (DSP prosody matching)\n- Support verse selection:\n  * List of verse references (e.g., [MAT.1.5, MAT.1.10])\n  * Or reference to change list file\n- Follow existing pattern from other config sections (audio_proof, compare, etc.)\n- Add validation in decode_yaml/depend.go","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-12T15:09:52.098212-07:00","updated_at":"2025-12-12T15:09:52.098212-07:00","source_repo":".","dependencies":[{"issue_id":"arti-1j9","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:09:52.101429-07:00","created_by":"daemon"}]}
{"id":"arti-1r4","content_hash":"3a5ebe2fa32b8fb04d6c51c044a09ce5f645d24ad72ec86af2365c31cc9c8dc7","title":"Generate revised HTML report for review (old vs new audio)","description":"HTML report generator for revised audio:\n- Similar structure to existing audio_proof HTML reports\n- Show: verse reference, original text, revised text (if changed)\n- Audio playback: original version + revised version\n- Highlight which words were replaced\n- Show source of replacement (book.chapter.verse, actor ID)\n- Include before/after waveform visualization (optional, nice-to-have)\n- Make it easy to review changes and validate quality\n- Output: standalone HTML file (like existing reports)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-12T15:09:20.223149-07:00","updated_at":"2025-12-12T15:09:20.223149-07:00","source_repo":".","dependencies":[{"issue_id":"arti-1r4","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:09:20.227296-07:00","created_by":"daemon"}]}
{"id":"arti-2ps","content_hash":"502fba4ab4a4a8e0efbe2b49822fe4a9420d3f090e832df1af412671aad8b90b","title":"Integrate So-VITS-SVC for voice conversion","description":"Integrate So-VITS-SVC (mature open-source RVC implementation) for neural voice conversion to replace DSP-based approach.\n\nTasks:\n- Research So-VITS-SVC installation and setup\n- Create training pipeline for speaker models using corpus data\n- Integrate inference into revise_audio voice conversion adapter\n- Train model on test speaker (Jude narrator)\n- Validate voice conversion quality\n- Update voice_conversion.py to use So-VITS-SVC instead of DSP approach\n\nSee revise_audio/history/RVC_EXPLANATION.md for why So-VITS-SVC was chosen over FCBH RVC.\n\nDependencies: arti-lmh (voice conversion infrastructure)","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-14T15:21:05.170672-07:00","updated_at":"2025-12-14T18:08:15.845391-07:00","source_repo":".","dependencies":[{"issue_id":"arti-2ps","depends_on_id":"arti-lmh","type":"blocks","created_at":"2025-12-14T15:21:05.177818-07:00","created_by":"daemon"}],"comments":[{"id":29,"issue_id":"arti-2ps","author":"jrstear","text":"So-VITS-SVC will support both use cases: (1) Text-driven: TTS → VC, (2) Audio-only: Recorded snippets → VC. Audio-only use case is actually simpler since input is already natural speech. See revise_audio/history/VOICE_CONVERSION_USE_CASES.md","created_at":"2025-12-15T01:05:33Z"},{"id":30,"issue_id":"arti-2ps","author":"jrstear","text":"Started So-VITS-SVC integration. Created directory structure in revise_audio/vits/, build_env.sh, Python inference wrapper (placeholder), and Go adapter. Next: Research actual So-VITS-SVC API and implement inference.","created_at":"2025-12-15T01:08:16Z"},{"id":31,"issue_id":"arti-2ps","author":"jrstear","text":"Decided to keep So-VITS-SVC as separate external dependency (like MMS). Updated Python wrapper to use SO_VITS_SVC_ROOT env var and implement actual Svc.slice_inference() API. Updated Go adapter to accept model_path, config_path, and speaker parameters.","created_at":"2025-12-15T01:14:21Z"},{"id":32,"issue_id":"arti-2ps","author":"jrstear","text":"Created test scripts and setup documentation. Integration code complete. Next: Install dependencies and test import, then train a test model.","created_at":"2025-12-15T01:15:48Z"},{"id":33,"issue_id":"arti-2ps","author":"jrstear","text":"Setup script updated. Environment created. Dependency conflict resolved with pip 24.0. Installation blocked by disk space - need to free up space before completing. Test import script ready.","created_at":"2025-12-15T01:24:51Z"},{"id":34,"issue_id":"arti-2ps","author":"jrstear","text":"✅ Setup complete! All dependencies installed successfully. So-VITS-SVC import test passes. Ready for model training and integration testing.","created_at":"2025-12-15T01:33:28Z"},{"id":35,"issue_id":"arti-2ps","author":"jrstear","text":"✅ Setup fully complete! Fixed numpy/openblas issue on macOS. So-VITS-SVC import test passes. All dependencies installed and verified. Ready for model training.","created_at":"2025-12-15T01:35:01Z"},{"id":36,"issue_id":"arti-2ps","author":"jrstear","text":"Training data extracted for Jude narrator (26 verses). Created training script. Ready to run preprocessing and training. Next: Run train_model.sh to train the model, then test inference on Jude 1:1.","created_at":"2025-12-15T01:37:11Z"}]}
{"id":"arti-3ky","content_hash":"a1f0209e97c0f7cdb12e1d7727f21585e017b56280fddf236a45660b8c087a36","title":"Web UI integration: support revise_audio job submission via controller/web","description":"Extend web interface for revise_audio:\n- Add revise_audio section to job submission form\n- Allow upload of revision list file (JSON)\n- Allow inline verse/word specification\n- Display status/progress for revise_audio jobs\n- Download links for:\n  * Revised chapter audio files\n  * Revised HTML report\n- Integration with existing web UI patterns\n- User-friendly error messages\n- Documentation/help text for non-technical users","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-12T15:10:07.019212-07:00","updated_at":"2025-12-12T15:10:07.019212-07:00","source_repo":".","dependencies":[{"issue_id":"arti-3ky","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:10:07.021233-07:00","created_by":"daemon"}]}
{"id":"arti-44l","content_hash":"6b3ab1f06cd7db5db3ce514b95cb060f9b2012a2b534500725af4ca5574cbe86","title":"Implement corpus search: find replacement words/phrases in existing recordings","description":"Search logic for finding replacement snippets:\n- Input: list of words/phrases to find (from revision request)\n- Search strategy (in priority order):\n  1. Same Actor ID + exact text match\n  2. Same Actor ID + normalized text match\n  3. Same Person + exact text match\n  4. Different speaker + exact text match\n- Search scope (fallback order): whole corpus, same book, nearby verses\n- Return: candidate snippets with metadata (Actor, Person, book, chapter, verse, word timestamps, quality scores)\n- Leverage existing Word table with timestamps for exact word boundaries","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-12T15:08:53.731153-07:00","updated_at":"2025-12-13T11:03:34.471676-07:00","source_repo":".","dependencies":[{"issue_id":"arti-44l","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:08:53.739051-07:00","created_by":"daemon"}],"comments":[{"id":5,"issue_id":"arti-44l","author":"jrstear","text":"Clarifications from discussion:\n\n1. Text normalization: Infer from existing code (check how text is normalized elsewhere in codebase)\n\n2. Input format: Assume html_report generation code will handle word/phrase identification. Will receive aligned text and audio. Long-term may have just timecodes + replacement audio.\n\n3. Distance scoring: Closer is better. Use word-distance, verse-distance, and book-distance. Create a composite 'away-from' score.\n\n4. Speaker matching: Start WITHOUT Actor/Person info. Focus on text matching + distance first. Actor/Person matching will be added later as optimization (makes VC/prosody easier).\n\n5. Return format: By default return best candidate, but provide option to get full ranked list with scores (text match, distance, actor factors).\n\n6. Matching: Start with exact text matching only. No fuzzy/phonetic matching for now (note for later). No manual search UI for now (interesting idea, note for later).\n\n7. Database indexes: Don't add unless functionally needed. Treat schema as not-in-my-domain for now.\n\n8. See #4 above.\n\n9. See #2 above.\n\n10. Context matching: Good idea. Multiple passes - find all candidates first, then secondary searches to rank them by matching context words.\n\n11. Audio snippet extraction: Don't duplicate metadata. Check if reusable layer exists (cli_misc/chop_audio/ uses ffmpeg directly, utility/ffmpeg/ffmpeg.go has ChopOneSegment). Build reusable layer in revise_audio if needed, then refactor chop_audio to use it later.\n\n12. No matches: Return list of candidates to user (book/chapter/verse/word info) for manual audio editing punch-list. Don't fail, just report candidates.","created_at":"2025-12-13T17:56:53Z"},{"id":6,"issue_id":"arti-44l","author":"jrstear","text":"Implementation approach:\n\n1. Text normalization: Use simple case-insensitive matching with trimmed whitespace for now. Found normalizeURoman in mms_align.go (lowercase + remove punctuation), but for exact matching we'll start simpler. Can refine later.\n\n2. Audio snippet extraction: Found utility/ffmpeg/ffmpeg.go has ChopOneSegment(ctx, tempDir, inputFile, beginTS, endTS) - perfect reusable function. Will use this directly, no need to build new layer yet.\n\n3. Database queries: Will use SelectWordsByBookChapter and SelectFAScriptTimestamps. Need to query Words table for text matching. Audio file path comes from Scripts.audio_file column.\n\n4. Distance calculation: Will compute verse distance (absolute difference in verse_seq), book distance (0 if same book, 1+ if different), and word distance (position in verse). Composite score: closer = better.\n\n5. Multi-pass search:\n   - Pass 1: Find all exact text matches in Words table\n   - Pass 2: Rank by distance (verse, book)\n   - Pass 3: (Future) Check context words for better ranking\n\n6. Return format: SnippetCandidate struct already defined. Will return best match by default, with option to return full ranked list.","created_at":"2025-12-13T17:57:02Z"},{"id":7,"issue_id":"arti-44l","author":"jrstear","text":"Database schema findings:\n\n- Words table has: word_id, script_id, word_seq, verse_num, ttype, word, uroman, word_begin_ts, word_end_ts, fa_score\n- Scripts table has: script_id, book_id, chapter_num, verse_str, audio_file, script_begin_ts, script_end_ts\n- SelectFAWordTimestamps() gets words with timestamps but no book/chapter filter\n- Need custom query: JOIN words + scripts, filter by book/chapter, get word text + timestamps + audio_file\n- Word timestamps are relative to chapter audio file (word_begin_ts, word_end_ts)\n\nFor phrase matching: Need to find consecutive words matching replacement text. Will query words, group by script_id, check for consecutive sequences.","created_at":"2025-12-13T17:57:14Z"},{"id":8,"issue_id":"arti-44l","author":"jrstear","text":"Final clarifications:\n\n1. Multi-word phrase matching: Prefer whole phrase in existing snippet if available, otherwise assemble from multiple sources (words from different locations).\n\n2. Audio file paths: Relative to FCBH_DATASET_FILES environment variable. Will resolve using os.Getenv(\"FCBH_DATASET_FILES\") + audio_file path.\n\n3. Verse distance: Use verse_num (start verse for snippet). May need to parse verse_str for ranges like \"6-10\". Per-word timing exists but may need to be extracted on-demand for matched verses (not all verses, only ones with matches).\n\n4. Book distance: Simple 0 (same book) vs 1 (different book) approach.\n\nImplementation plan:\n- Create corpus_search.go with FindReplacementSnippets() function\n- Query words table with JOIN to scripts for text matching\n- Handle single-word and multi-word phrase matching\n- Calculate distance scores (verse_num, book, word position)\n- Return ranked SnippetCandidate list\n- Use utility/ffmpeg/ChopOneSegment for audio extraction (separate task)","created_at":"2025-12-13T18:03:27Z"},{"id":9,"issue_id":"arti-44l","author":"jrstear","text":"Implementation complete:\n\n- Created corpus_search.go with CorpusSearcher\n- Implemented FindReplacementSnippets() with phrase and word matching\n- Text normalization: case-insensitive, trimmed\n- Distance calculation: composite score (book + chapter + verse)\n- Ranking: prioritizes exact matches, nearby verses, lower distance\n- Returns best match by default, or all candidates if returnAll=true\n- Handles actor/person info from scripts table\n- Resolves audio file paths relative to FCBH_DATASET_FILES\n\nReady for testing with html_report test case.","created_at":"2025-12-13T18:07:07Z"},{"id":10,"issue_id":"arti-44l","author":"jrstear","text":"Jude test case learnings:\n\n1. Source of truth: Human review of compare.html is baseline\n   - Recordings don't exactly match target text\n   - Transcriptions aren't perfect\n   - Human identifies which differences actually need correction\n\n2. Whole-word differences are more significant than sub-word:\n   - Entire word differences (e.g., 'by' → 'in') = likely need correction\n   - Sub-word differences (e.g., 'jed' vs 'jude') = likely transcription error, audio is fine\n\n3. Test case: Jude 1:1\n   - 'jude' (first word): NO CHANGE - audio is fine\n   - 'loved by' → 'loved in': CHANGE NEEDED\n   - 'kept by' → 'kept for': CHANGE NEEDED\n\n4. Corpus: Use engniv2011 dataset (1984 audio) as source for finding replacement snippets\n\nDatabase: /Users/jrstear/fcbh/arti/old/engniv2011/00005/database/engniv2011.db\nAudio: B26___01_Jude________ENGNIVN1DA.mp3\nVerse 1 timestamps: 1.96s - 12.97s","created_at":"2025-12-14T16:37:36Z"},{"id":13,"issue_id":"arti-44l","author":"jrstear","text":"Test results for Jude 1:1:\n\n1. Phrase search: No exact phrase matches found for 'loved in' or 'kept for' in corpus (excluding JUD)\n   - Falls back to single word matches (expected behavior)\n   - Found 'loved' in MAL 1:2, 1TH 1:4, etc.\n   - Found 'kept' in 1PE 1:4, 1SA 1:6, etc.\n\n2. Single word search: Working correctly\n   - Found 'in' in JUD 1:2 (distance: 1) - nearby verse, good candidate\n   - Found 'for' in JUD 1:3 (distance: 2) - nearby verse, good candidate\n\n3. Fix applied: Excluded target verse (JUD 1:1) from search results\n\nNext: Need to decide strategy for phrase replacement:\n- Option A: Use single word matches and assemble (may need voice conversion)\n- Option B: Search for similar phrases (e.g., 'loved by' + 'in' separately)\n- Option C: Use nearby verses (JUD 1:2, 1:3) as source for single words","created_at":"2025-12-14T16:39:24Z"},{"id":14,"issue_id":"arti-44l","author":"jrstear","text":"Correction: Removed target verse exclusion\n\nUser feedback: If needed words are found in the same verse, that's ideal - just copy them over. No need to exclude target verse from search.\n\nTest results show:\n- 'in' exists in JUD 1:1 at word_seq 44 (10.12-10.24s)\n- 'for' exists in JUD 1:1 at word_seq 56 (11.68-11.92s)\n\nSo for 'loved by' → 'loved in', we can use the existing 'in' from the same verse!\nFor 'kept by' → 'kept for', we can use the existing 'for' from the same verse!\n\nThis is the best case scenario - same verse, same speaker, same context.","created_at":"2025-12-14T16:44:40Z"},{"id":17,"issue_id":"arti-44l","author":"jrstear","text":"CORRECTION: Database transcription vs actual audio\n\nThe database transcription shows 2011 text ('loved in', 'kept for'), but the audio actually says 1984 text ('loved by', 'kept by').\n\nSo 'in' and 'for' are NOT in verse 1 audio - they're only in the corrected database transcription.\n\nWe need to find 'in' and 'for' in OTHER verses (verse 2, 3, etc.) or other books to use as replacement snippets.\n\nThe corpus search should prioritize nearby verses (JUD 1:2, 1:3, etc.) for best speaker/prosody match.","created_at":"2025-12-14T16:47:54Z"}]}
{"id":"arti-62u","content_hash":"71476773f93b08d5db522a34e9db4ee16ffe38e84cdb7bb937b9fa3a09c283e3","title":"Testing and validation: end-to-end revise_audio workflow","description":"Comprehensive testing:\n- Test with real datasets (minority languages)\n- Validate voice conversion quality (same speaker, different speaker cases)\n- Validate prosody matching (natural-sounding transitions)\n- Test edge cases:\n  * Multiple words in sequence\n  * Overlapping revisions\n  * Words not found in corpus\n  * Same word, different contexts\n- Performance testing (large chapters, many revisions)\n- User acceptance testing with non-technical users\n- Document known limitations and best practices\n- Create test datasets for regression testing","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-12T15:10:10.937379-07:00","updated_at":"2025-12-12T15:10:10.937379-07:00","source_repo":".","dependencies":[{"issue_id":"arti-62u","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:10:10.93835-07:00","created_by":"daemon"}]}
{"id":"arti-6dt","content_hash":"deeaa0303db987334fdff7cc6dfd648d1e81d3b0c4649c0d35371dffad770e2d","title":"Enhance audio_proof HTML report: add selection UI for words/verses to revise","description":"Modify HTML report to allow selection:\n- Add checkboxes/selection UI for each verse/word discrepancy\n- Allow selecting entire verses or individual words within verses\n- Visual highlighting of selected items\n- Button to 'Export Revision List' or 'Create Revision Job'\n- Export format: JSON file with selected revisions:\n  * Verse references\n  * Word indices (if word-level)\n  * Original text, expected text\n- Store selections client-side (localStorage) for user convenience\n- Non-technical friendly UI (clear labels, instructions)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-12T15:09:56.106946-07:00","updated_at":"2025-12-12T15:09:56.106946-07:00","source_repo":".","dependencies":[{"issue_id":"arti-6dt","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:09:56.109185-07:00","created_by":"daemon"}]}
{"id":"arti-7qf","content_hash":"bd12fbce7727553e9b68b5934e8861ff34164b5ed36a98dce491aaad0a385f5e","title":"Implement audio snippet extraction from chapter files","description":"Extract word/phrase audio snippets:\n- Input: word-level timestamps from corpus search results\n- Extract audio segments from chapter files using timestamps\n- Handle word sequences (multiple words that form a phrase)\n- Add padding/context (e.g., 0.1s before/after for natural boundaries)\n- Output: audio snippets as temporary files (WAV format)\n- Reuse existing audio file handling from input package","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-12T15:08:57.12953-07:00","updated_at":"2025-12-14T09:47:22.94696-07:00","source_repo":".","dependencies":[{"issue_id":"arti-7qf","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:08:57.132369-07:00","created_by":"daemon"}],"comments":[{"id":12,"issue_id":"arti-7qf","author":"jrstear","text":"Jude test case context:\n\nAudio file: B26___01_Jude________ENGNIVN1DA.mp3\nDatabase: engniv2011.db has word-level timestamps\nVerse 1: 1.96s - 12.97s, 61 words with timestamps\n\nFor snippet extraction:\n- Use word timestamps from database to identify exact boundaries\n- Extract replacement snippets from corpus matches\n- Use utility/ffmpeg.ChopOneSegment() for extraction","created_at":"2025-12-14T16:37:41Z"},{"id":15,"issue_id":"arti-7qf","author":"jrstear","text":"Jude 1:1 test case requirements:\n\nTarget verse: JUD 1:1\nAudio file: B26___01_Jude________ENGNIVN1DA.mp3\nDatabase has word-level timestamps already\n\nReplacements needed:\n1. 'by' (after 'loved') → 'in' (already exists in verse 1 at word_seq 44, 10.12-10.24s)\n2. 'by' (after 'kept') → 'for' (already exists in verse 1 at word_seq 56, 11.68-11.92s)\n\nStrategy: Extract existing words 'in' and 'for' from same verse, copy to replace 'by' positions.\n\nWord-level timestamps available in database - use these for exact boundaries.\nUse utility/ffmpeg.ChopOneSegment() for extraction.","created_at":"2025-12-14T16:44:54Z"},{"id":16,"issue_id":"arti-7qf","author":"jrstear","text":"Implementation complete:\n\n- Created snippet_extract.go with SnippetExtractor\n- ExtractSnippet: extracts from SnippetCandidate\n- ExtractWord: extracts single word by book/chapter/verse/wordSeq\n- ExtractPhrase: extracts phrase (consecutive words) by wordSeq range\n- Uses utility/ffmpeg.ChopOneSegment() for extraction\n- Resolves audio file paths from FCBH_DATASET_FILES\n- Queries database for word-level timestamps\n\nReady for testing with Jude 1:1 test case.","created_at":"2025-12-14T16:47:23Z"},{"id":18,"issue_id":"arti-7qf","author":"jrstear","text":"CORRECTION: Replacement words not in verse 1 audio\n\nThe database transcription shows 2011 text, but audio says 1984 text.\n\nReplacement snippets found:\n- 'in' in JUD 1:2 (word_seq 14, 15.46-15.52s) - closest match\n- 'for' in JUD 1:3 (word_seq 55, 26.54-26.62s) - close match\n\nTo replace 'by' in verse 1:\n1. Need to find where 'by' actually is in verse 1 audio\n2. May need to run word-level alignment on verse 1 with 1984 text to get 'by' timestamps\n3. Extract 'in' from 1:2 and 'for' from 1:3\n4. Replace 'by' segments with extracted snippets","created_at":"2025-12-14T16:48:00Z"},{"id":19,"issue_id":"arti-7qf","author":"jrstear","text":"Clarification: FA scores reveal the issue\n\nDatabase has word-level timestamps, but:\n- 'in' (word_seq 44): fa_score = 2.18e-05 (very low!) - alignment failed\n- 'for' (word_seq 56): fa_score = 1.61e-05 (very low!) - alignment failed\n- 'loved' (word_seq 42): fa_score = 0.993 (high) - good alignment\n- 'kept' (word_seq 54): fa_score = 0.998 (high) - good alignment\n\nLow FA scores indicate the audio says 'by' at those timestamps, not 'in'/'for'.\n\nSolution: Extract verse 1 audio segment and run forced alignment with 1984 text (which has 'by') to get accurate timestamps for 'by'.","created_at":"2025-12-14T16:50:22Z"},{"id":20,"issue_id":"arti-7qf","author":"jrstear","text":"Solution: Use existing word-level timestamps with low FA scores\n\nThe database already has timestamps for word_seq 44 and 56, but with very low FA scores (indicating misalignment).\n\nFor now, we can use those timestamps as approximate locations for 'by':\n- word_seq 44 timestamp (10.12-10.24s) ≈ location of 'by' after 'loved'\n- word_seq 56 timestamp (11.68-11.92s) ≈ location of 'by' after 'kept'\n\nThese are close enough for initial testing. If more precision is needed later, we can implement verse-level re-alignment with 1984 text.\n\nNext: Extract 'in' from JUD 1:2 and 'for' from JUD 1:3, then replace segments at the approximate 'by' locations.","created_at":"2025-12-14T16:51:07Z"},{"id":21,"issue_id":"arti-7qf","author":"jrstear","text":"Environment check for M1 Mac:\n\n- System: M1 Mac (arm64) with 16GB RAM\n- Conda: Available but environments not listed (may need activation)\n- Environment variables: FCBH_DATASET_FILES, FCBH_DATASET_TMP, FCBH_DATASET_DB not set\n- Memory: 16GB should be sufficient for snippet extraction (ffmpeg operations are lightweight)\n\nFor snippet extraction, we only need:\n- ffmpeg (system tool, not Python)\n- Go code (no Python dependencies needed yet)\n\nPython dependencies (revise_audio conda env) will be needed later for voice conversion and prosody matching.\n\nNext: Set environment variables and test snippet extraction.","created_at":"2025-12-14T16:55:54Z"},{"id":22,"issue_id":"arti-7qf","author":"jrstear","text":"M1 Mac memory considerations:\n\nFor snippet extraction (current task):\n- Only uses ffmpeg (system tool, very lightweight)\n- No Python/ML models loaded\n- 16GB RAM is more than sufficient\n- No memory concerns\n\nFor future tasks (voice conversion, prosody matching):\n- Will load PyTorch models (HuBERT, RVC, etc.)\n- M1 Mac: Use CPU or MPS (Metal Performance Shaders)\n- 16GB may be tight for large models\n- Consider: Process one verse at a time, unload models between verses\n- Monitor memory usage with: vm_stat or Activity Monitor\n\nConda environment 'revise_audio' not yet created - will be needed later for Python dependencies.","created_at":"2025-12-14T16:56:08Z"}]}
{"id":"arti-9j0","content_hash":"0f324e07c8471fa5aa35907d7b9e88fca3eea7e182c10005493eacf37a035443","title":"Implement change list file format and parsing","description":"Standardized format for revision requests:\n- JSON format for revision list:\n  * Dataset reference\n  * List of revisions (verse/word references)\n  * Optional: word mappings (original -\u003e replacement)\n- Support both:\n  * File-based input (user uploads/specifies file)\n  * Inline YAML specification\n- Parser to convert to internal RevisionRequest structure\n- Validation: ensure verse references are valid, words exist in corpus\n- Integration with existing Script/Word table queries","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-12T15:10:00.447119-07:00","updated_at":"2025-12-12T15:10:00.447119-07:00","source_repo":".","dependencies":[{"issue_id":"arti-9j0","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:10:00.449623-07:00","created_by":"daemon"}]}
{"id":"arti-a2g","content_hash":"8f03ec02831456efdd3825e904ceececd5085e3b96d24c4cd2b007449c56bdfc","title":"Implement DSP-based prosody matching (F0, energy, timing)","description":"Prosody adjustment using DSP (Phase 1, simplest approach):\n- Extract prosody features from context (surrounding verses in target chapter):\n  * F0 (pitch) contour\n  * Energy/loudness envelope  \n  * Speaking rate/timing\n- Adjust extracted snippet to match:\n  * Pitch shifting to match F0 contour\n  * Time-stretching to match speaking rate\n  * Loudness normalization\n- Use librosa or similar for audio manipulation\n- Keep natural-sounding (avoid artifacts)\n- This is the \"boring but important DSP\" mentioned in notes","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-12T15:09:06.465145-07:00","updated_at":"2025-12-12T15:09:06.465145-07:00","source_repo":".","dependencies":[{"issue_id":"arti-a2g","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:09:06.470407-07:00","created_by":"daemon"}],"comments":[{"id":28,"issue_id":"arti-a2g","author":"jrstear","text":"Prosody matching implemented and working, but temporarily disabled to focus on voice conversion quality first. Will re-enable after So-VITS-SVC integration.","created_at":"2025-12-14T22:21:01Z"}]}
{"id":"arti-b0j","content_hash":"cb194b7de2711add54bf71a9436e4cf27dda8117daaa482948cb558ef2c31e2b","title":"Integrate revise_audio into controller workflow","description":"Add revise_audio processing to controller:\n- Add ReviseAudio method to controller/controller.go\n- Process revise_audio config section (similar to audio_proof, compare)\n- Coordinate with existing modules:\n  * Read from database (Script/Word tables)\n  * Use input package for audio file access\n  * Use output package for revised audio files\n  * Generate HTML reports\n- Handle job dependencies: requires audio_proof to have run first\n- Error handling and logging\n- Status reporting for long-running operations","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-12T15:10:03.741949-07:00","updated_at":"2025-12-12T15:10:03.741949-07:00","source_repo":".","dependencies":[{"issue_id":"arti-b0j","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:10:03.744408-07:00","created_by":"daemon"}]}
{"id":"arti-bue","content_hash":"2149f4939fe6d1be6bd41b3a8ac1564fc9db3f6cd9d724f3ff120409ceeafed9","title":"Implement audio stitching: replace segments in chapter audio","description":"Seamless audio replacement:\n- Input: original chapter audio + list of (start_ts, end_ts, replacement_audio)\n- Replace segments with crossfading at boundaries\n- Crossfade duration: ~50-100ms for natural transitions\n- Maintain chapter timing (don't shift later verses)\n- Handle overlapping replacements\n- Output: revised chapter audio file\n- Preserve original as backup\n- Validate duration matches (within tolerance)","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-12T15:09:10.87399-07:00","updated_at":"2025-12-14T13:44:47.583679-07:00","source_repo":".","dependencies":[{"issue_id":"arti-bue","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:09:10.876183-07:00","created_by":"daemon"}],"comments":[{"id":23,"issue_id":"arti-bue","author":"jrstear","text":"Implementation complete:\n\n- Created audio_stitch.go with AudioStitcher\n- ReplaceSegmentInChapter: replaces segment with cross-fades\n- Uses ffprobe to get audio durations\n- Applies fade-in/fade-out to segments\n- Concatenates segments using ffmpeg concat demuxer\n- Default 50ms cross-fade (configurable, max 200ms)\n\nTest results for Jude 1:1:\n- Successfully replaced 'by' (10.12-10.24s) with 'in' from verse 2\n- Successfully replaced 'by' (11.68-11.92s) with 'for' from verse 3\n- Created final stitched output with both replacements\n\nCross-fade implementation:\n- Before segment: fade-out at end\n- Replacement segment: fade-in at start, fade-out at end\n- After segment: fade-in at start\n- All segments concatenated seamlessly","created_at":"2025-12-14T20:44:49Z"},{"id":24,"issue_id":"arti-bue","author":"jrstear","text":"Issue identified: Cross-fade duration too long for short snippets\n\nProblem:\n- Replacement snippets are very short (~0.06s for 'in', ~0.10s for 'for')\n- Applying 50ms fade-in + 50ms fade-out to a 60ms snippet leaves almost nothing audible\n- Fixed: Auto-adjust fade duration for short snippets (max fade = (duration - 20ms) / 2)\n\nAlso need to verify:\n- We're replacing the correct segments (where 'by' actually is in audio)\n- The replacement is being inserted properly (not just removed)\n- Second replacement timing accounts for first replacement shifting timestamps","created_at":"2025-12-14T20:53:31Z"},{"id":25,"issue_id":"arti-bue","author":"jrstear","text":"Fixed cross-fade for short snippets. New file generated at ~/tmp/arti_revised_audio/JUD_01_revised.wav\n\nPlease test the new version - the 'in' should now be audible since cross-fades are auto-adjusted for short snippets.\n\nIf 'in' is still not audible, we may need to:\n1. Verify the replacement snippet itself is good quality\n2. Check if we need to adjust the replacement segment boundaries\n3. Consider using a longer context window for the replacement","created_at":"2025-12-14T20:53:41Z"}]}
{"id":"arti-c12","content_hash":"bce234ef23d50a2c7eb1bb17d2a2b2084537179d4a561b897ca37c12b6609a15","title":"Research and select voice conversion \u0026 prosody matching tooling stack","description":"Research available options and make recommendations:\n- Voice conversion: RVC (existing FCBH system) vs OpenVoice vs other\n- Prosody matching: DSP-based (F0/energy) vs neural approaches\n- Prioritize: easiest/working solution first, can upgrade later\n- Document decision with rationale in revise_audio/ directory\n- Consider Go integration vs Python module (similar to existing MMS pattern)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T15:08:46.987449-07:00","updated_at":"2025-12-13T10:19:55.399871-07:00","closed_at":"2025-12-13T10:19:55.399871-07:00","source_repo":".","dependencies":[{"issue_id":"arti-c12","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:08:46.989825-07:00","created_by":"daemon"}],"comments":[{"id":2,"issue_id":"arti-c12","author":"jrstear","text":"Research complete. Recommendations documented in revise_audio/TOOLING_RESEARCH.md\n\nKey decisions:\n- Voice Conversion: Use existing FCBH RVC system (HuBERT + X-Vector + HiFi-GAN)\n- Prosody Matching: Start with DSP-based (librosa + pyworld), upgrade to neural later if needed\n- Integration: Follow MMS adapter pattern (Go → Python subprocess)\n\nRationale: Leverages existing proven codebase, fastest path to working solution, language-agnostic, can upgrade incrementally.","created_at":"2025-12-13T17:19:49Z"},{"id":3,"issue_id":"arti-c12","author":"jrstear","text":"Updated research document to be more critical and honest about uncertainties. Key changes:\n\n- Separated externally verified facts from FCBH codebase claims\n- Acknowledged that 'proven on minority languages' is a claim, not verified\n- Noted that recommendation is pragmatic (use what exists) rather than optimal (best possible)\n- Added section on what we actually know vs. what's claimed\n- Suggested validation/comparison testing in Phase 2\n\nThe recommendation stands (use FCBH RVC) but now with appropriate caveats about uncertainty.","created_at":"2025-12-13T17:25:41Z"}]}
{"id":"arti-lmh","content_hash":"3611c2a129972a243adce7b24763203825d0f493b6ad72e3122a57b02460f694","title":"Integrate voice conversion (Python module): RVC-based speaker matching","description":"Voice conversion integration:\n- Create Python module for VC (similar to mms/ adapter pattern)\n- Use existing FCBH RVC infrastructure as starting point\n- Accept: source audio + target speaker embedding\n- Return: converted audio (same speaker identity)\n- Handle cases: same speaker (passthrough), different speaker (VC needed)\n- Extract speaker embeddings from target verse context\n- Document integration approach (Go -\u003e Python via subprocess/stdin-stdout or other)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-12T15:09:01.408446-07:00","updated_at":"2025-12-12T15:09:01.408446-07:00","source_repo":".","dependencies":[{"issue_id":"arti-lmh","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:09:01.410545-07:00","created_by":"daemon"}],"comments":[{"id":27,"issue_id":"arti-lmh","author":"jrstear","text":"Voice conversion infrastructure implemented but DSP-based approach (pitch shift + loudness) produces intelligible but unacceptable results. Decision: Proceed with So-VITS-SVC (Option 4) for neural voice conversion. See revise_audio/history/SESSION_SUMMARY_2024-12-14.md and VOICE_CONVERSION_ALTERNATIVES.md for details.","created_at":"2025-12-14T22:21:00Z"}]}
{"id":"arti-wug","content_hash":"5cfeeb478c8189ae0f58939eebae1c2609b057b581f63a7a14e030dd398872c9","title":"Create revise_audio directory structure and Go module foundation","description":"Set up basic structure:\n- Create revise_audio/ package directory\n- Define core data structures (RevisionRequest, SnippetCandidate, etc.)\n- Set up integration points with db package (Script, Word tables)\n- Create interfaces for VC and prosody modules\n- Basic error handling and logging","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T15:08:49.509518-07:00","updated_at":"2025-12-13T10:31:23.451956-07:00","closed_at":"2025-12-13T10:31:23.451956-07:00","source_repo":".","dependencies":[{"issue_id":"arti-wug","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:08:49.510738-07:00","created_by":"daemon"}],"comments":[{"id":4,"issue_id":"arti-wug","author":"jrstear","text":"Created revise_audio directory structure and Go module foundation:\n\n- models.go: Core data structures (RevisionRequest, SnippetCandidate, etc.)\n- revise_audio.go: Main module struct\n- vc_adapter.go: Voice conversion interface and RVC adapter stub\n- prosody_adapter.go: Prosody matching interface and DSP adapter stub\n- python/voice_conversion.py: Python stub for RVC integration\n- python/prosody_match.py: Python stub for prosody matching\n- build_env.sh: Conda environment setup (supports M1 Mac and AWS EC2)\n- README.md: Documentation\n\nAll files follow existing patterns from mms/ modules. Python scripts use JSON I/O via stdin/stdout. Environment variables: FCBH_REVISE_AUDIO_VC_PYTHON and FCBH_REVISE_AUDIO_PROSODY_PYTHON.","created_at":"2025-12-13T17:31:23Z"}]}
{"id":"arti-z97","content_hash":"4785fc4ac1a8099d62cec24b0c0cbd31c929d1def3c0482d2ffeee99baa187b3","title":"Audio Revision System: Verse-level find-and-replace with voice cloning and prosody matching","description":"Epic: Build complete audio revision system for FCBH workflow. Users identify verses/words needing correction from audio_proof HTML reports, system finds replacement snippets in corpus, applies voice conversion and prosody matching, outputs revised chapter audio files + review HTML report.\n\nWorkflow:\n1. User runs audio_proof with html_report\n2. User identifies verses/words to revise from HTML report\n3. System searches corpus for replacement snippets (prioritizing same speaker)\n4. Extracts audio snippets\n5. Applies voice conversion if needed (different speaker)\n6. Adjusts prosody to match context\n7. Stitches into revised chapter audio\n8. Generates HTML report for review\n\nPhase 1: Manual experiments (build infrastructure)\nPhase 2: YAML integration + web UI","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-12T15:08:35.702225-07:00","updated_at":"2025-12-12T15:08:35.702225-07:00","source_repo":".","comments":[{"id":1,"issue_id":"arti-z97","author":"jrstear","text":"Phase 1 Dependency Flow:\n1. arti-c12 (Research tooling) - First step\n2. arti-wug (Directory structure) - Depends on research\n3. arti-44l (Corpus search) - Depends on structure\n4. arti-7qf (Snippet extraction) - Depends on search\n5. arti-lmh (Voice conversion) - Depends on research + structure (can parallel with 44l)\n6. arti-a2g (Prosody matching) - Depends on extraction + VC\n7. arti-bue (Audio stitching) - Depends on prosody\n8. arti-zh7 (CLI tool) - Depends on stitching\n9. arti-1r4 (HTML report) - Depends on stitching\n\nPhase 2 (YAML integration):\n- Depends on Phase 1 completion\n- arti-1j9, arti-6dt, arti-9j0 can proceed in parallel\n- arti-b0j depends on YAML parsing + change list\n- arti-3ky depends on controller integration\n- arti-62u is final validation step","created_at":"2025-12-12T22:10:20Z"},{"id":11,"issue_id":"arti-z97","author":"jrstear","text":"Workflow clarification from Jude test case:\n\n1. Human review process:\n   - Human reviews compare.html to identify actual differences needing correction\n   - Not all differences require audio changes (some are transcription errors)\n   - Whole-word differences prioritized over sub-word differences\n\n2. Revision request format:\n   - Human identifies specific words/phrases to change\n   - System searches corpus for replacement snippets\n   - System applies voice conversion and prosody matching\n   - System stitches revised audio back into chapter\n\n3. Test case: Jude 1:1\n   - Two word changes identified: 'loved by'→'loved in', 'kept by'→'kept for'\n   - Ready to test corpus search and revision workflow","created_at":"2025-12-14T16:37:39Z"}]}
{"id":"arti-z97.1","content_hash":"ff24fe93a8a8cb790d5b25e0d8f3416383eddfb5a8d43a64f70ee722e126a5d0","title":"Find high-confidence segment boundaries for audio revision","description":"Instead of using imprecise word-level timestamps, find natural cut-points like pauses/silence between words (e.g., pause between 'called' and 'who'). Use these boundaries to define segments, then generate entire segments via TTS with replacement words and replace the whole segment.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T14:31:37.03012-07:00","updated_at":"2025-12-14T15:21:12.288169-07:00","closed_at":"2025-12-14T15:21:12.288169-07:00","source_repo":".","dependencies":[{"issue_id":"arti-z97.1","depends_on_id":"arti-z97","type":"parent-child","created_at":"2025-12-14T14:31:37.032885-07:00","created_by":"daemon"}],"comments":[{"id":26,"issue_id":"arti-z97.1","author":"jrstear","text":"Analyzed data and created generalized rules for segment boundary detection:\n\nKey findings:\n- Boundary after 'called' (our start): 700ms gap + high FA (0.954/0.916) = score 5.0 (excellent)\n- Other excellent boundaries found: after 'Jude' (600ms gap), after 'James' (1280ms gap)\n\nGeneralized rules implemented:\n1. Large gaps (\u003e300ms) = natural pauses = excellent boundaries\n2. High FA scores (\u003e=0.9) on both sides = reliable timings = good boundaries  \n3. Combination of both = BEST boundaries (score \u003e= 4.0)\n\nScoring system:\n- Gap \u003e500ms: +3.0, \u003e300ms: +2.0, \u003e150ms: +1.0\n- FA \u003e=0.95: +1.0, \u003e=0.9: +0.5, both \u003e=0.9: +0.5 bonus\n- Score \u003e= 2.0 = good boundary, \u003e= 4.0 = excellent boundary\n\nUpdated DetectBoundariesFromDB() to use gap analysis + FA scores for boundary detection.","created_at":"2025-12-14T21:45:16Z"}]}
{"id":"arti-zh7","content_hash":"422e09e4c80d087aa166d960d38266175ade12249561539825da3822dc1dfbd9","title":"Create manual CLI tool for testing audio revision workflow","description":"Command-line tool for Phase 1 testing:\n- Accept: dataset name, verse references, words to replace\n- Example: ./revise_audio --dataset Test1 --verse MAT.1.5 --words \"love\" --target-actor 1\n- Run full pipeline: search -\u003e extract -\u003e VC -\u003e prosody -\u003e stitch\n- Output: revised chapter audio + metadata JSON\n- Allow testing individual steps in isolation\n- Useful for validating each component before YAML integration","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-12T15:09:15.335695-07:00","updated_at":"2025-12-12T15:09:15.335695-07:00","source_repo":".","dependencies":[{"issue_id":"arti-zh7","depends_on_id":"arti-z97","type":"blocks","created_at":"2025-12-12T15:09:15.338514-07:00","created_by":"daemon"}]}
